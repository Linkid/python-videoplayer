image: Visual Studio 2015
platform: x64

cache: c:\tools\vcpkg\installed\

init:
    - set arch= Win64
    - echo %arch%
    - echo %APPVEYOR_BUILD_WORKER_IMAGE%

install:
    - set PATH=C:\Python37-x64;C:\Python37-x64\Scripts;%PATH%

    # Check that we have the expected version and architecture for Python
    - "python --version"
    - "build.cmd python --version"
    - "build.cmd python -c \"import struct; print(struct.calcsize('P') * 8)\""
    - "build.cmd python -c \"import platform; print(platform.platform())\""
    - "build.cmd python -c \"import platform; print(platform.processor())\""
    - "build.cmd python -c \"import platform; print(platform.architecture())\""

    # install 3rd party libs
    - echo %platform%
    - vcpkg install glib:%platform%-windows
                    libogg:%platform%-windows
                    libtheora:%platform%-windows
                    ffmpeg:%platform%-windows
    - vcpkg export  glib:%platform%-windows
                    libogg:%platform%-windows
                    libtheora:%platform%-windows
                    ffmpeg:%platform%-windows --zip
    - ps: cp c:\Tools\vcpkg\"vcpkg-export-*.zip" .
    - pwd
    - cd c:\tools\vcpkg
    - vcpkg integrate install
    - vcpkg list --triplet x64-windows
    - cd %APPVEYOR_BUILD_FOLDER%  # c:\projects\python-videoplayer

build_script:
    - set VERBOSE=1
    - mkdir wheelhouse

    - cmake --version
    - build.cmd python -m pip install --upgrade pip
    - build.cmd python -m pip install scikit-build cython pytest
    #- python.exe -m pip install scikit-build cython conan pytest
    #- python.exe setup.py build_ext --inplace --force -- -D_CONAN=YES # -G "Visual Studio 14 2015%arch%"
    - build.cmd python setup.py build_ext --inplace --force -- -D_VCPKG=YES -DVCPKG_TARGET_TRIPLET:STRING=x64-windows -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake -G "Visual Studio 14 2015%arch%"
    - 7z a skbuild.zip %APPVEYOR_BUILD_FOLDER%/_skbuild/win-amd64-3.7
    #- build.cmd python setup.py test
    #- python.exe setup.py sdist --dist-dir wheelhouse
    #- python.exe setup.py bdist_wheel --dist-dir wheelhouse


artifacts:
    - path: "wheelhouse\\*.whl"
      name: Wheels
    #- path: "skbuild.zip"
    #  name: skbuid
    - path: "*.zip"
