environment:
    matrix:
        ## linux
        #- APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu
        #  APPVEYOR_JOB_NAME: "python37-x64-ubuntu"
        #  compiler: gcc

        ## osx
        #- APPVEYOR_BUILD_WORKER_IMAGE: macos-mojave
        #  APPVEYOR_JOB_NAME: "python37-x64-macos-mojave"
        #  compiler: clang

        # windows
        - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
          APPVEYOR_JOB_NAME: "python37-x64-vs2015"
          ARCH: amd64
          arch: Win64
          platform: x64
          PYTHON_ARCH: "64"

stack: python 3.7

init:
    - set arch=
    - if "%arch%"=="Win64" ( set arch= Win64)
    - echo %arch%
    - echo %APPVEYOR_BUILD_WORKER_IMAGE%

install:
    - cmd: set PATH=C:\Python37;C:\Python37\Scripts;%PATH%
    # C:\msys64\usr\bin\pacman -S --noconfirm mingw64/mingw-w64-x86_64-python3
    - cmd: vcpkg install glib:%platform%-windows
                         libogg:%platform%-windows
                         libtheora:%platform%-windows
                         ffmpeg:%platform%-windows
    - pwd
    - cd c:\tools\vcpkg
    - vcpkg integrate install
    - cd c:\projects\python-videoplayer
    - vcpkg list --triplet x64-windows

    # Check that we have the expected version and architecture for Python
    - "python --version"
    - "python -c \"import struct; print(struct.calcsize('P') * 8)\""
    - "build.cmd python --version"
    - "build.cmd python -c \"import struct; print(struct.calcsize('P') * 8)\""

build_script:
    - mkdir wheelhouse

    - cmake --version
    - python.exe -m pip install --upgrade pip
    - python.exe -m pip install scikit-build cython pytest
    #- python.exe -m pip install scikit-build cython conan pytest
    #- python.exe setup.py build_ext --inplace --force -- -D_CONAN=YES -G "Visual Studio 14 2015%arch%"
    - python.exe setup.py build_ext --inplace --force -- -D_VCPKG=YES -DVCPKG_TARGET_TRIPLET=x64-windows -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake -G "Visual Studio 14 2015%arch%"
    - python.exe setup.py test
    #- python.exe setup.py sdist --dist-dir wheelhouse
    #- python.exe setup.py bdist_wheel --dist-dir wheelhouse


artifacts:
    - path: "wheelhouse\\*.whl"
      name: Wheels
